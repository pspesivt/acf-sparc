{"Next.js Code Patterns":{"Database Interaction":"use preconfigured Prisma Client;reject schema changes","Server vs Client":{"Server Component":"//app/users/[id]/page.tsx\nexport async function generateMetadata({params}:Props):Promise<Metadata>{const user=await db.user.findUnique({where:{id:params.id}});return user?{title:`${user.name}'s Profile`}:{title:'Not Found'}}\nexport default async function UserPage({params}:Props){const user=await db.user.findUnique({where:{id:params.id},include:{posts:{take:5,orderBy:{createdAt:'desc'}}}});if(!user)notFound();return <UserProfile user={user}/>;}","Client Component":"'use client';export function ThemeSwitcher(){const[m,setM]=useState(false);const{theme,setTheme}=useTheme();useEffect(()=>setM(true),[]);if(!m)return null;return <button onClick={()=>setTheme(theme==='dark'?'light':'dark')}>{theme==='dark'?'‚òÄÔ∏è':'üåô'}</button>;}"},"Data Fetching":{"Parallel":"export default async function Dashboard(){const [users,posts,stats]=await Promise.all([db.user.findMany(),db.post.findMany(),fetchStats()]);return(<><UserList users={users}/><RecentPosts posts={posts}/><Stats data={stats}/></>);}","Streaming":"export default function DashboardPage(){return(<><h1>Dashboard</h1><QuickStats/><Suspense fallback={<Loading/>}><SlowChart/></Suspense></>);}","Revalidation":{"Time-based(ISR)":"const products=await fetch('https://api.example/products',{next:{revalidate:3600}});","On-demand":"export async function POST(r:NextRequest){const{path,tag,secret}=await r.json();if(secret!==process.env.REVALIDATION_SECRET)return NextResponse.json({error:'Unauthorized'},{status:401});path?revalidatePath(path):revalidateTag(tag);return NextResponse.json({revalidated:true});}"} },"Forms":{"Server Actions":"'use server';const ContactSchema=z.object({name:z.string().min(2),email:z.string().email(),message:z.string().min(10)});export async function submitContact(prevState:State,formData:FormData){const r=ContactSchema.safeParse(Object.fromEntries(formData));if(!r.success)return{errors:r.error.flatten().fieldErrors};await db.contact.create({data:r.data});revalidatePath('/contact');return{success:true};}","Client Component":"'use client';export function ContactForm(){const[state,formAction]=useFormState(submitContact,{});return<form action={formAction}><input name=\"name\"/>{state.errors?.name&&<p className=\"text-red-500\">{state.errors.name[0]}</p>}<button type=\"submit\">Submit</button></form>;}"},"API Routes":"//app/api/users/route.ts\nconst UserSchema=z.object({name:z.string().min(2),email:z.string().email()});export async function GET(request:NextRequest){const session=await auth();if(!session)return NextResponse.json({error:'Unauthorized'},{status:401});const{searchParams}=new URL(request.url);const page=parseInt(searchParams.get('page')||'1');const limit=10;const[users,total]=await Promise.all([db.user.findMany({skip:(page-1)*limit,take:limit}),db.user.count()]);return NextResponse.json({users,total,page});}export async function POST(request:NextRequest){const body=await request.json();const r=UserSchema.safeParse(body);if(!r.success)return NextResponse.json({error:r.error.flatten()},{status:400});const user=await db.user.create({data:r.data});return NextResponse.json(user,{status:201});}","Error Handling":"//app/error.tsx\n'use client';export default function Error({error,reset}){useEffect(()=>console.error(error),[error]);return<div className=\"flex flex-col items-center p-8\"><h2 className=\"text-xl font-bold text-red-600\">Something broke</h2><button onClick={reset} className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded\">Try again</button></div>;}//app/not-found.tsx\nexport default function NotFound(){return<div className=\"text-center p-8\"><h2 className=\"text-2xl font-bold\">404</h2><Link href=\"/\" className=\"text-blue-600 hover:underline\">Go home</Link></div>;}","Auth (NextAuth)":"//auth.ts\nexport const {auth,signIn,signOut}=NextAuth({adapter:PrismaAdapter(db),session:{strategy:'jwt'},callbacks:{async session({token,session}){if(session.user){session.user.id=token.sub;session.user.role=token.role as UserRole;}return session;},async jwt({token}){if(!token.sub)return token;const user=await getUserById(token.sub);if(user)token.role=user.role;return token;}}});\n//middleware.ts\nexport default auth(req=>{const isLoggedIn=!!req.auth;const isAdmin=req.nextUrl.pathname.startsWith('/admin');if(isAdmin&&(!isLoggedIn||req.auth?.user?.role!=='ADMIN'))return Response.redirect(new URL('/auth/login',req.nextUrl));});export const config={matcher:['/((?!api|_next/static|_next/image|favicon.ico).*)']};","Optimization":{"Images":"<Image src=\"/hero.jpg\" alt=\"Hero\" width={1200} height={600} priority sizes=\"(max-width: 768px) 100vw, 50vw\" className=\"object-cover\"/>","Code Splitting":"const HeavyChart=dynamic(()=>import('@/components/chart'),{loading:()=><Skeleton/>,ssr:false});"},"Anti-Patterns":{"1.Client Everything":"//WRONG\n'use client';export default function BlogList(){const[posts,setPosts]=useState([]);useEffect(()=>fetch('/api/posts').then(r=>r.json()).then(setPosts),[]);return<>‚Ä¶</>;}//RIGHT\nexport default async function BlogList(){const posts=await db.post.findMany();return<>‚Ä¶</>;","2.No Metadata":"//WRONG\nexport default function Page(){return<div>Content</div>;}//RIGHT\nexport const metadata={title:'Page Title',description:'Page description',openGraph:{title:'Page Title',images:['/og.jpg']}};","3.API Calls in RSC":"//WRONG\nconst data=await fetch('http://localhost:3000/api/data');\n//RIGHT\nconst data=await db.data.findMany();","4.Loose Types":"//WRONG\nexport default function User({user}){return<h1>{user.name}</h1>;}\n//RIGHT\ninterface UserProps{user:{id:string;name:string;role:'ADMIN'|'USER'}};export default function User({user}:UserProps){return<h1>{user.name}</h1>;}"}}}